<!-- templates/header.html -->
<header class="bg-secondary text-white sticky top-0 z-50 menu">
    <div class="container mx-auto px-4 py-2">
        <div class="flex items-center justify-between flex-wrap">
            <!-- Logo/Name -->
            <div class="flex-shrink-0 flex items-center space-x-4">
                {% if settings['logo_path'] %}
                <a href="{{ url_for('public.index') }}">
                    <img src="{{ url_for('static', filename=settings['logo_path']) }}" alt="{{ settings['site_name'] }} Logo" class="h-10">
                </a>
                {% else %}
                <span class="text-xl font-bold">{{ settings['site_name'] }}</span>
                {% endif %}
            </div>

            <!-- Search Bar (Full-width on mobile) -->
            <div class="w-full md:flex-1 md:mx-4 mt-2 md:mt-0 order-2 md:order-1">
                <form method="GET" action="{{ url_for('public.search_products') }}" class="relative">
                    <input 
                        type="text" 
                        name="q" 
                        placeholder="What do you want to buy...?" 
                        class="w-full py-3 px-4 pr-12 rounded-md text-gray-900 focus:ring-primary text-base md:text-sm"
                        required
                    >
                    <button type="submit" class="absolute right-0 top-0 h-full px-4 bg-primary text-gray-900 rounded-r-md hover:bg-primary-90">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </form>
            </div>

            <!-- Hamburger Menu Button (Visible on mobile) -->
            <div class="md:hidden order-1 md:order-2">
                <button id="menu-toggle" class="text-white focus:outline-none">
                    <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>

            <!-- Desktop Navigation & Account Links -->
            <div class="hidden md:flex items-center space-x-6 order-2">
                {% if 'user_id' in session %}
                <div class="relative group">
                    <a href="{{ url_for('user.dashboard') }}" class="hover:text-primary">Hello, {{ session['username'] }}</a>
                    <span class="block font-bold">Account & Lists</span>
                </div>
                <a href="#" class="hover:text-primary">Report</a>
                <a href="{{ url_for('public.logout') }}" class="hover:text-primary">Logout</a>
                {% else %}
                <div class="relative group">
                    <a href="{{ url_for('user.login') }}" class="hover:text-primary">Hello, Sign in</a>
                    <span class="block font-bold">Account & Lists</span>
                </div>
                <a href="{{ url_for('user.register') }}" class="hover:text-primary">Register</a>
                {% endif %}
                <div class="relative">
                    <a href="{{ url_for('cart.view_cart') }}" class="flex items-center hover:text-primary">
                        <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-primary text-gray-900 rounded-full w-5 h-5 flex items-center justify-center text-xs">
                            {% if 'user_id' in session %}
                                {{ cart_count|default(0) }}
                            {% else %}
                                0
                            {% endif %}
                        </span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Mobile Menu (Hidden by default, toggled by hamburger) -->
        <div id="mobile-menu" class="hidden md:hidden w-full mt-2 bg-gray-800 rounded-md shadow-lg">
            <nav class="flex flex-col space-y-2 p-4 text-sm">
                <a href="#" class="hover:text-primary">All</a>
                {% for category in top_level_categories %}
                <div class="relative">
                    <a href="{{ url_for('public.category_products', category_id=category['id']) }}" class="hover:text-primary">{{ category['name'] }}</a>
                    {% if category['subcategories'] %}
                    <div class="ml-4 mt-1 space-y-1">
                        {% for subcat in category['subcategories'] %}
                        <a href="{{ url_for('public.category_products', category_id=subcat['id']) }}" class="block text-gray-300 hover:text-primary">{{ subcat['name'] }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                <a href="{{ url_for('public.how_to_pay') }}" class="hover:text-primary">Payment</a>
                <a href="{{ url_for('public.how_to_sell') }}" class="hover:text-primary">How to Sell</a>
                <a href="{{ url_for('public.privacy_policy') }}" class="hover:text-primary">Privacy</a>
                <a href="{{ url_for('public.marketplace_rules') }}" class="hover:text-primary">Rules</a>
                {% if 'user_id' in session %}
                <a href="#" class="hover:text-primary">Hello, {{ session['username'] }}</a>
                <a href="#" class="hover:text-primary">Report Vendor</a>
                <a href="{{ url_for('public.logout') }}" class="hover:text-primary">Logout</a>
                {% else %}
                <a href="{{ url_for('user.login') }}" class="hover:text-primary">Sign In</a>
                <a href="{{ url_for('user.register') }}" class="hover:text-primary">Register</a>
                {% endif %}
            </nav>
        </div>

        <!-- Desktop Category Navigation -->
        <div class="hidden md:block py-2 mt-2">
            <div class="container mx-auto px-4">
                <nav class="flex items-center space-x-4 text-sm">
                    <a href="#" class="hover:text-primary">All</a>
                    {% for category in top_level_categories %}
                    <div class="relative group">
                        <a href="{{ url_for('public.category_products', category_id=category['id']) }}" class="hover:text-primary">{{ category['name'] }}</a>
                        {% if category['subcategories'] %}
                        <div class="absolute left-0 mt-0 hidden group-hover:block bg-gray-700 text-white rounded-md shadow-lg z-10">
                            <ul class="py-2">
                                {% for subcat in category['subcategories'] %}
                                <li>
                                    <a href="{{ url_for('public.category_products', category_id=subcat['id']) }}" class="block px-4 py-2 hover:bg-gray-600 whitespace-nowrap">
                                        {{ subcat['name'] }}
                                        {% if subcat['subcategories'] %}
                                        <span class="text-gray-400 text-xs">({{ subcat['subcategories']|length }} subcategories)</span>
                                        {% endif %}
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    <a href="{{ url_for('public.how_to_pay') }}" class="hover:text-primary">Payment</a>
                    <a href="{{ url_for('public.how_to_sell') }}" class="hover:text-primary">How to Sell</a>
                    <a href="{{ url_for('public.privacy_policy') }}" class="hover:text-primary">Privacy</a>
                    <a href="{{ url_for('public.marketplace_rules') }}" class="hover:text-primary">Rules</a>
                </nav>
            </div>
        </div>
    </div>
</header>

<!-- JavaScript for Hamburger Menu -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');

        menuToggle.addEventListener('click', function () {
            mobileMenu.classList.toggle('hidden');
        });
    });
</script>